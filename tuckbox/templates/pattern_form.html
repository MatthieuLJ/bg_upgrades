<head>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- Include our own CSS -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'tuckbox/style.css' %}">

    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- cookie plugin -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

    <script type="text/javascript">

// Some constants for paper sizes:
var paper_a4 = {
    "width" : 210,
    "height" : 297
};

var paper_a3 = {
    "width" : 297,
    "height" : 420
};

var paper_letter = {
    "width" : 216,
    "height" : 279
};

var paper_legal = {
    "width" : 216,
    "height" : 356
};


function check_number(field) {
    if(field.value != "" && (isNaN(field.value) || (field.value < 0))) {
        $(field).css('color','red');
    } else {
        $(field).css('color','black');
    }
}

// Entry function when the page is loaded
$(function() {
    // For all the elements with the "tuck_input_num" class
    // hook the check number function with the error label also
    $(".tuck_input_num").change(function() {check_number(this)});

    // Hide the entries for custom paper sizes and set them to appear
    // on that specific selection
    $(".paper_custom").css('display', 'none');
    $("#paper-size").change(function() {
        if (this.value == "Custom") {
            $(".paper_custom").css('display', '');
        } else {
            $(".paper_custom").css('display', 'none');
        }
    });

    $.ajaxSetup({
        headers: { "X-CSRFToken": Cookies.get("csrftoken") }
    });

    $("#id_preview").click(function() {
        var data = {
            "paper" : {
                "width" : 100,
                "height": 100 },
                "tuckbox" : {
                    "width" : parseInt($('#id_width').val()),
                    "height" : parseInt($('#id_height').val()),
                    "depth" : parseInt($('#id_depth').val()) }
        };
        console.log(data);
        $.post('preview', JSON.stringify(data), show_preview);
    });

    function show_preview(data, status) {
        console.log("updating preview, status="+status)
        $('#image_preview').html('<img src="data:image/png;base64,' + data + '" class="img-thumbnail img-responsive" />');

    }
});
    </script>
</head>

<body>

<h1>Enter the dimensions for your box</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


<div class="container">
    <form action="{% url 'pattern' %}" method="post" target="_blank">
        {% csrf_token %}

        <div class="row">
            <div class="label col-md">
                Paper size:
            </div>
            <div class="col-md">
                <select id="paper-size" name="paper size">
                    <option value="A4">A4</option>
                    <option value="A3">A3</option>
                    <option value="Letter">Letter</option>
                    <option value="Legal">Legal</option>
                    <option value="Custom">Custom</option>
                </select>
            </div>
        </div>
        <div class="row paper_custom">
            <div class="label col-md">
                Paper Height (mm):
            </div>
            <div class="col-md">
                <input type="text" name="paper_height" id="id_paper_height" class="tuck_input_num">
            </div>
        </div>
        <div class="row paper_custom">
            <div class="label col-md">
                Paper Width (mm):
            </div>
            <div class="col-md">
                <input type="text" name="paper_width" id="id_paper_width" class="tuck_input_num">
            </div>
        </div>
        <div class="row">
            <div class="label col-md">
                Height (mm):
            </div>
            <div class="col-md">
                <input type="text" name="height" id="id_height" class="tuck_input_num">
            </div>
        </div>
        <div class="row">
            <div class="label col-md">
                Width (mm):
            </div>
            <div class="col-md">
                <input type="text" name="width" id="id_width" class="tuck_input_num">
            </div>
        </div>
        <div class="row">
            <div class="label col-md">
                Depth (mm):
            </div>
            <div class="col-md">
                <input type="text" name="depth" id="id_depth" class="tuck_input_num">
            </div>
        </div>
        <div class="row">
            <div class="col-md">
                <button type="button" id="id_preview" value="preview">Show preview</button>
            </div>
            <div id="image_preview" class="col-md">
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
                <input type="submit" value="send">
            </div>
        </div>
    </form>
</div>
</body>

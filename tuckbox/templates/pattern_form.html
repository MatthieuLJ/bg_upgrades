<head>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- Include our own CSS -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'tuckbox/style.css' %}">

    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- cookie plugin -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

    <script type="text/javascript">

function check_number(field, error_label_id) {
    if(field.value != "" && (isNaN(field.value) || (field.value < 0))) {
        $(error_label_id).css('visibility','visible');
    } else {
        $(error_label_id).css('visibility','hidden');
    }
}

// Entry function when the page is loaded
$(function() {
    // For all the elements with the "tuck_input_num" class
    // hook the check number function with the error label also
    $(".tuck_input_num").change(function() {check_number(this, "#" + this.id + "_error")});

    $.ajaxSetup({
        headers: { "X-CSRFToken": Cookies.get("csrftoken") }
    });

    $("#id_preview").click(function() {
        var data = {
            "paper" : {
                "width" : 100,
                "height": 100 },
                "tuckbox" : {
                    "width" : parseInt($('#id_width').val()),
                    "height" : parseInt($('#id_height').val()),
                    "depth" : parseInt($('#id_depth').val()) }
        };
        console.log(data);
        $.post('preview', JSON.stringify(data), show_preview);
    });

    function show_preview(data, status) {
        console.log("updating preview, status="+status)
        $('#image_preview').html('<img src="data:image/png;base64,' + data + '" />');

    }
});
    </script>
</head>

<body>

<h1>Enter the dimensions for your box</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


<div class="container">
    <form action="{% url 'pattern' %}" method="post">
        {% csrf_token %}

        <div class="row">
            <div class="label col-md">
                Height (mm):
            </div>
            <div class="col-md">
                <input type="text" name="height" id="id_height" class="tuck_input_num">
            </div>
            <div id="id_height_error" class="input_error col-sm">
                This needs to be a valid number
            </div>
        </div>
        <div class="row">
            <div class="label col-md">
                Width (mm):
            </div>
            <div class="col-md">
                <input type="text" name="width" id="id_width" class="tuck_input_num">
            </div>
            <div id="id_width_error" class="input_error col-sm">
                This needs to be a valid number
            </div>
        </div>
        <div class="row">
            <div class="label col-md">
                Depth (mm):
            </div>
            <div class="col-md">
                <input type="text" name="depth" id="id_depth" class="tuck_input_num">
            </div>
            <div id="id_depth_error" class="input_error col-sm">
                This needs to be a valid number
            </div>
        </div>
        <div class="row">
            <button type="button" id="id_preview" value="preview">
        </div>
        <div id="image_preview" class="row">
        </div>
        <div class="row">
            <input type="submit" value="send">
        </div>
    </form>
</div>
</body>
